extends ../../layout.pug

block content
    .content-header
        .container-fluid
            .row.mb-3.mt-3
                .col-sm-6
                    h1.m-0.text-dark Accepted Orders

    .content
        .container-fluid
            if successes
                for success in successes
                    div.alert.alert-success #{ success }
            if errors
                for error, i in errors
                    div.alert.alert-danger #{ error.message }
            .row
                .col-12
                    .card
                        .card-header
                            h3.card-title All Accepted Orders
                            form(action=`/dashboard/users/searchResult`, method="post")
                                input(type="hidden" name="_csrf" value=`${csrfToken}`)
                                .input-group.input-group-sm.float-right(style="width: 150px;")
                                    if dataProvided
                                        input.form-control.float-right(type="text" name="table_search" placeholder="Search")
                                    if tbSearch
                                        input.form-control.float-right(type="text", value = `${table_search}`, name="table_search" placeholder="Search")
                                    .input-group-append
                                    button.btn.btn-default(type="submit")
                                        i.fas.fa-search
                        .card-body.table-responsive.p-0
                            table.table.table-hover.text-nowrap
                                thead
                                    tr
                                    th Date 
                                    th orderID 
                                    th Customer Name 
                                    th Customer Mobile No  
                                    th Property Owner 
                                    th Property 
                                    th Review 
                                tbody
                                    if dataProvided
                                        - var dataArray = dataProvided.docs
                                        - var hasPrev = dataProvided.hasPrevPage 
                                        - var hasNext = dataProvided.hasNextPage 
                                        - var totalPages = dataProvided.totalPages 
                                        - var pages = 1
                                        - var page = dataProvided.page 
                                        - var num = (page-1)*dataProvided.limit+1

                                        for product in dataArray
                                            tr
                                            td #{ product.createdAt.toDateString() }
                                            td #{ product.orderId }
                                            td #{ product.nameCustomer }
                                            td #{ product.customerMobileNo }
                                            td 
                                                if product.propertyId
                                                       #{product.propertyId.mobileNumber}     
                                                else
                                                        span N/M
                                                                            
                                            td
                                                if product.propertyId
                                                        a.btn-sm.btn-primary(href=`/list/${product.propertyId.slugArabic}` target="_blank")
                                                            i.far.fa-eye
                                                            |  View Property 
                                                else
                                                        span Product Deleted                                               
                                            td
                                                form(action=`/dashboard/booking/checkpoint?id=${product.id}&request=booked`, method="post")
                                                    input(type="hidden" name="_csrf" value=`${csrfToken}`)
                                                    button.btn-sm.btn-success(type="submit")
                                                        | Booked                                       
                                            td
                                               form(action=`/dashboard/booking/checkpoint?id=${product.id}&request=retension`, method="post")
                                                    input(type="hidden" name="_csrf" value=`${csrfToken}`)
                                                    button.btn-sm.btn-danger(type="submit")
                                                        | Reject                                       
                        .card-footer.clearfix
                            ul.pagination.pagination-sm.m-0.float-right
                                if hasPrev
                                    li.page-item
                                        a.page-link(href=href=`/dashboard/booking?p=${page - 1}`) «
                                if totalPages > 1
                                    while pages  < 3            
                                        li.page-item
                                            if pages === page
                                                a.page-link.active( style="background-color:rgba(0,0,0,0.1); color:black;" )= pages
                                            else
                                                a.page-link.active( href=`/dashboard/booking?p=${pages}`)= pages

                                        - pages++    

                                if hasNext
                                    li.page-item
                                        a.page-link(href=`/dashboard/booking?p=${page + 1}`) »                            